---
title: "Electric Vehicle Data Analysis"
author: "Anoop S Hari"
date: "2023-12-04"
output:
  word_document: default
  html_document:
    theme: cerulean
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE
)
```

[Link to Dataset](https://www.kaggle.com/datasets/adilashrafi/elecrict-vehicle) 

This comprehensive dataset provides detailed information on Battery Electric Vehicles (BEVs) and Plug-in Hybrid Electric Vehicles (PHEVs) currently registered through the Washington State Department of Licensing (DOL). It offers a thorough examination of electric vehicle ownership patterns and trends, including vehicle registration, make, model, electric vehicle type, clean alternative fuel vehicle (CAFV) eligibility, electric range, base MSRP, legislative district, DOL vehicle ID, vehicle location, electric utility, and 2020 Census tract.\ 


![EV](ev2.jpg){width=500px}
\

- **Battery Electric Vehicles (BEVs):**
BEVs run entirely on electricity stored in a battery pack. They don't have a traditional internal combustion engine; instead, they use an electric motor to power the vehicle.

- **Plug-in Hybrid Electric Vehicles (PHEVs):**
PHEVs have both an electric motor and an internal combustion engine. They use a larger battery pack than conventional hybrids, allowing them to travel a certain distance on electric power alone.

- **Clean alternative fuel vehicle (CAFV):**
Clean Alternative Fuel Vehicle (CAFV) eligibility typically refers to the qualifications or criteria that a vehicle must meet in order to be considered a clean alternative fuel vehicle. Eligibility for CAFVs can vary depending on the context, such as government incentives, tax credits, regulatory definitions, or programs aimed at promoting environmentally friendly transportation. 

- **Base MSRP:**
Manufacturer's Suggested Retail Price, which is the initial price set by the vehicle manufacturer for a standard or base model of a vehicle. This price typically includes the cost of the vehicle itself with standard equipment and does not include any optional features, taxes, destination charges, registration fees, or other additional costs.

### Objectives:

**1. CAFV Eligibility and Trends:**
   
   - What percentage of the registered vehicles are considered Clean Alternative Fuel Vehicle (CAFV) eligible?
   
   - Are there any noticeable trends or changes in CAFV eligibility among different vehicle types or over various model years?

**2. Electric Range Distribution:**
   
   - What is the distribution of electric ranges among BEVs and PHEVs in the dataset?
   
   - Are there specific clusters or ranges where most vehicles fall, and how do these ranges impact eligibility and adoption?

**3. Base MSRP Analysis:**
   
   - What is the range and distribution of Base Manufacturer's Suggested Retail Price (MSRP) across different vehicle types and models?
   
   - Are there correlations between MSRP and CAFV eligibility or electric range?

**4. Geographical Insights:**
   
   - How are these electric vehicles distributed geographically across counties and cities within Washington State?

**5. Utility Provider Preferences:**
   
   - Is there a preference for a particular electric utility among the registered electric vehicles?
   

```{r}
# installing the required packages
install.packages(c("tidyverse","plotly","ggthemes", "bslib"), repos = "https:\\cran.rstudio.com")
library(tidyverse)
library(plotly)
library(ggthemes)
library(bslib)
library(knitr)

# Loading the data
ev <- read.csv("F:\\R practice\\R Projects\\Project 5\\EV Project\\Electric_Vehicle_Population_Data.csv")

# checking head and str
str(ev)
head(ev)

# Checking for null values
any(is.na(ev))

# Count of NA's with column names
null <- colSums(is.na(ev))

null[null > 0]

# imputing NA's with 0
ev$Postal.Code[is.na(ev$Postal.Code)] <- 0
ev$Legislative.District[is.na(ev$Legislative.District)] <- 0
ev$X2020.Census.Tract[is.na(ev$X2020.Census.Tract)] <- 0
```
### Analysis:

1. CAFV Eligibility and Trends:
   - What percentage of the registered vehicles are considered Clean Alternative Fuel Vehicle (CAFV) eligible?
   - Are there any noticeable trends or changes in CAFV eligibility among different vehicle types or over various model years?
   
```{r}
# For better readability the values of 'Electric.Vehicle.Type' column is changed to 
# 'BEV' for Battery Electric Vehicle 
# & PHEV for Plug-in Hybrid Electric Vehicles 
ev_clean <- ev %>% 
  mutate(Electric.Vehicle.Type = ifelse(Electric.Vehicle.Type == "Battery Electric Vehicle (BEV)", "BEV", "PHEV"))

# Changing column name Clean.Alternative.Fuel.Vehicle..CAFV..Eligibility to CAFV_Eligibility
ev_clean <- ev_clean %>% 
  mutate(CAFV_Eligibility = Clean.Alternative.Fuel.Vehicle..CAFV..Eligibility)

ev_clean <- ev_clean %>% 
  select(- Clean.Alternative.Fuel.Vehicle..CAFV..Eligibility)

# Clean Alternative Fuel Vehicle percentage
CAFV_perc <- ev_clean %>% 
  group_by(CAFV_Eligibility) %>% 
  summarise(count = n()) %>% 
  mutate(Perc = (count / sum(count))* 100)
```
##### Looking for trends in Vehicle Type and Model Year
```{r}
# Columns to look for:
        # CAFV eligibility
        # Electric.Vehicle.Type
        # Model.Year

ggplot(ev_clean, aes(x = Electric.Vehicle.Type)) +
  geom_bar(aes(fill = factor(Model.Year))) +
  labs(title = "Distribution of Vehicle Type vs Model Year" ,
       x = "Model Type", 
       subtitle = "Highest number of vehicles are manufactured on 2023",
       fill = "Model Year")
```

The analyzed data underscores a prevailing dominance of Battery Electric Vehicles (BEVs) throughout 2022 to 2024, totaling 66,032 units, with a consistent increase in BEV production. Intriguingly, 2024 presents a notable surge in planned manufacturing of Plug-in Hybrid Electric Vehicles (PHEVs) over BEVs, signaling a potential market shift. The peak production year for both BEVs and PHEVs aligns in 2023, reflecting the zenith in vehicle output for both categories. These insights illuminate an evolving landscape favoring all-electric models, accompanied by a marked rise in interest or planned production of plug-in hybrid variants in the most recent year.

```{r}
# Looking for distinct values in CAFV_Eligibility column
table(ev_clean$CAFV_Eligibility)

# For better readability changing the values of CAFV_Eligibility to 
# Eligible, Not Eligible and Unknown 
ev_clean$CAFV_Eligibility[ev_clean$CAFV_Eligibility == "Clean Alternative Fuel Vehicle Eligible"] <- "Eligible"
ev_clean$CAFV_Eligibility[ev_clean$CAFV_Eligibility == "Eligibility unknown as battery range has not been researched"] <- "Unknown"
ev_clean$CAFV_Eligibility[ev_clean$CAFV_Eligibility == "Not eligible due to low battery range"] <- "Not Eligible"     

#setting a common theme for all ggplot visuals
theme_set(theme_few())

# Checking the Distribution of Vehicle Type with CAFV Eligibility
ggplot(ev_clean, aes(x = CAFV_Eligibility)) +
  geom_bar(aes(fill = Electric.Vehicle.Type)) +
  labs(title = "Distribution of Vehicle Type vs CAFV Eligibility",
       x = "CAFV Eligibility", fill = "Vehicle Type") +
  theme_few()
```
```
'Unknown' is the predominant eligibility type for most vehicles, with Battery Electric Vehicles (BEV) leading in manufacturing.
```
```{r}
# Subsetting 'Model Year' is necessary due to lower data counts before 2011
year <- c(2011:2024)

ev_year_adjusted<- ev_clean %>% 
  subset(Model.Year %in% year) 

# Finding out distribution of 'Make' with 'Model Year'
ggplot(ev_year_adjusted, aes(x = factor(Model.Year))) +
  geom_bar(aes(fill = Make)) +
  theme_few() +
  coord_flip() +
  labs(title = "Model Year VS Make", 
       x = "Count",
       y = "Model Year")
```
```
'Tesla' stands as the most frequent 'Make' among registered vehicles.
```
2. Electric Range Distribution:
   - What is the distribution of electric ranges among BEVs and PHEVs in the dataset?
   - Are there specific clusters or ranges where most vehicles fall, and how do these ranges impact eligibility and adoption?
   
```{r}
# Filtering out PHEVs with an electric range of 0, as they operate on both electric charge and gasoline.
ev_range <- ev_clean %>% 
  filter(Electric.Range > 0) %>% 
  subset(Model.Year %in% year)

# boxplot to understand the distribution
ggplot(ev_range, aes(x = Electric.Vehicle.Type, y = Electric.Range)) + 
  geom_boxplot(color = "blue", fill = "grey",alpha = 0.7) +
  labs(title = "Distribution of Vehicle Type VS Electric Range",
       x = "Vehicle Type") + theme_igray()
```
```
For BEVs, half of the electric range falls between 125 to 238 miles, whereas for PHEVs, 50% of the range lies 
between 21 to 38 miles.
```
```{r}
# Electric range variation across different model years
ggplot(ev_range, aes(x = Electric.Vehicle.Type, y = Electric.Range)) +
  geom_boxplot(aes(fill = Electric.Vehicle.Type)) +
  facet_wrap(~Model.Year) +
  guides(fill = FALSE) +
  labs(title = "Electric Range over the years in BEV's and PHEV's",
       x = "Vehicle Type", 
       y = "Electric Range") 
```
```
Electric range for BEVs shows a consistent rise over the years, but this upward trend diminishes after 2020. 
Conversely, electric range for PHEVs doesn't exhibit significant growth across the years.
```

3. Base MSRP Analysis:
   - What is the range and distribution of Base Manufacturer's Suggested Retail Price (MSRP) across different vehicle types and models?
   - Are there correlations between MSRP and CAFV eligibility or electric range?
   
```{r}
# I opted to filter out the numerous zero values to obtain a clearer depiction.
msrp <- ev_clean %>% 
  filter(Base.MSRP > 0)

ggplot(msrp, aes(x = Electric.Vehicle.Type, y = Base.MSRP )) +
 geom_boxplot() # noticed an outlier

# finding outlier
sorted_msrp <- msrp %>% 
  arrange(-Base.MSRP)
```
```
Typically, the Base MSRP of PHEV vehicles is lower than that of BEVs. As the maximum Base MSRP of a BEV in this 
dataset stands at 110950, I chose to filter out PHEV values exceeding this threshold for a refined analysis.
```
```{r}
msrp_at <- msrp %>% 
  filter(!(Base.MSRP > 110950))

# Distribution of Base MSRP with Vehicle Type
ggplot(msrp_at, aes(x = Electric.Vehicle.Type, 
                    y = Base.MSRP )) +
  geom_boxplot(color = "#046576", 
               fill = "#45C8C4", 
               alpha = 0.3) +
              theme_igray() +
              labs(x = "Vehicle Type", 
              y = "Base MSRP", 
              title = "Distribution of Base MSRP with Vehicle Type")
```

Half of the BEVs exhibit a base MSRP falling between 33,950 and 69,900, while 50% of PHEVs showcase a base MSRP ranging from 39,995 to 54,950.

From this information, it can be inferred that, on average:

- BEVs tend to have a broader range in terms of base MSRP, spanning from 33,950 to 69,900, indicating a wider spectrum of pricing among these vehicles.

- Conversely, PHEVs demonstrate a narrower pricing range, with 50% of the vehicles falling within the range of 39,995 to 54,950. This suggests a relatively more clustered pricing distribution among PHEVs compared to BEVs.

Overall, this analysis provides insight into the diverse pricing structures between BEVs and PHEVs, showcasing different concentration patterns within their respective price ranges.

```{r}
# Vehicle Model VS Base MSRP
ggplot(msrp_at, aes(x = Base.MSRP, y = Model)) +
  geom_col(aes(fill = Electric.Vehicle.Type)) +
  labs(title = "Vehicle Model VS Base MSRP", 
       x = "Base MSRP", 
       fill = "Vehicle Type",
       subtitle =  expression(bold("'Model S' is having the highest Base MSRP and the least being 'Wheego'")))+
  scale_fill_manual(values = c("#EA5046", "#4696EA")) +
  theme_hc() +
  theme(plot.subtitle = element_text(color = "#666260",size = 9),
        plot.title = element_text(color = "#5046EA"))
```
```
Base MSRP of 'Model S' is the highest and 'Weego' the lowest.
```
```{r}
# finding correlation between MSRP and electric range
correlation1 <- cor(msrp_at$Base.MSRP, msrp_at$Electric.Range)

# Plotting Correlation between Base MSRP and Electric Range
ggplot(msrp_at, aes(x = Electric.Range, 
                    y = Base.MSRP))+
  geom_point( aes(color = Electric.Vehicle.Type, 
                  shape = Electric.Vehicle.Type), 
                  size = 3) +
  geom_smooth(method = lm, se = F, color = "#478E6B") +
  scale_color_manual(values = c("#A40F03", "#2A3277"), 
                     name = "Vehicle Type")+
  labs(title = "Correlation between Base MSRP and Electric Range", 
       x = "Electric Range", y = "Base MSRP", 
       shape = "Vehicle Type") +
  theme_stata()
```
```
There is a moderate correlation (0.5982857) observed between Base MSRP and Electric Range, signifying a notable 
association between these two attributes.
```
4. Geographical Insights:
   - How are these electric vehicles distributed geographically across counties and cities within Washington State?
   
```  
To simplify chart labels, I opted to filter out state and county names by focusing on the top 20 entries. 
Given that the majority of sales occur in WA state, I won't be examining state-specific trends.
```
```{r}
county_filt <- ev_clean %>% 
  group_by(County) %>% 
  summarise(Vehicle_Count = n())

print(county_filt)

state_filt <- ev_clean %>% 
  group_by(State) %>% 
  summarise(Vehicle_Count = n())

print(state_filt)

# Finding the top 20 Counties 
county_filt_desc <- county_filt %>% 
  arrange(desc(Vehicle_Count))

top_20_county <- head(county_filt_desc,20)


kable(top_20_county)

# Top 20 Counties with most number of Vehicle Registrations
ggplot(top_20_county, aes(x = County, 
                          y = Vehicle_Count)) +
  geom_bar(stat = "identity", 
           fill = "#825555") +
  coord_flip()+
  labs(title = expression(bold("Top 20 Counties with most number of Vehicle Registrations")),
      subtitle = expression(italic("King County leads with 83,413 registrations"))) +
  theme(plot.subtitle = element_text(color = "#666260",size = 9),
        plot.title = element_text(color = "#632B02", size = 11))
```
```
King County leads with the highest registrations, totaling 83,413, followed by Snohomish with 18,544
registrations.
```
5. Utility Provider Preferences:
   - Is there a preference for a particular electric utility among the registered electric vehicles?
   
```{r}
eu_count <- ev_clean %>% 
  group_by(Electric.Utility) %>% 
  summarise(Count = n())

eu <- eu_count %>% 
  arrange(-Count) 

# Top 3 Electric Utilities
top_3_eu <- head(eu,3)

kable(top_3_eu)
```

### Conclusion

The analysis encompassed various aspects of the electric vehicle dataset, providing several key insights:

- **Manufacturing Trends:** Over the observed years (2022-2024), Battery Electric Vehicles (BEVs) significantly outnumber Plug-in Hybrid Electric Vehicles (PHEVs), with a consistent increase in BEV production. Conversely, PHEV production doesn't exhibit a steady rise, remaining relatively stable.

- **Vehicle Eligibility:** The majority of vehicles have an 'Unknown' Clean Alternative Fuel Vehicle (CAFV) eligibility type, while BEVs dominate as the most manufactured vehicle type.

- **Popular Make:** Tesla emerges as the most registered vehicle make, indicative of its widespread presence in the dataset.

- **Electric Range:** BEVs tend to have a wider range with an average of (215-302 miles) compared to PHEVs (21-38 miles), with a steady increase in BEV range over the years until a decline post-2020. PHEVs, however, show limited range variation over time.

- **Base MSRP:** Half of the BEVs fall within a price range of $33,950 to $69,900, while 50% of PHEVs range between $39,995 and $54,950. 'Model S' boasts the highest Base MSRP, while 'Weego' records the lowest.

- **Correlation:** A moderate correlation (0.5982857) exists between Base MSRP and Electric Range, suggesting a noticeable association between these variables.

- **Registration Distribution:** King County holds the highest number of registrations (83,413), followed by Snohomish with 18,544 registrations.

Considering these findings collectively, the dataset reveals a dominance of BEVs in both production and electric range expansion, while PHEVs maintain a more stable presence. Tesla stands out as a popular make among registered vehicles. The moderate correlation between Base MSRP and Electric Range highlights a notable relationship between pricing and vehicle range. Moreover, geographical distribution is concentrated in King County, emphasizing localized registration patterns. These findings collectively illustrate the dynamic landscape of electric vehicles, portraying shifting trends in production, pricing, and range among different vehicle types over the observed period.
  




